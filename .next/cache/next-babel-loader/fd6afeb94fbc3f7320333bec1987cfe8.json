{"ast":null,"code":"import { GoogleSpreadsheet } from 'google-spreadsheet';\nimport credentials from '../../credentials.json';\nimport moment from 'moment';\nconst doc = new GoogleSpreadsheet('1g9vwNQMbh1YADO14sN_-0R7qFvF9wM3EBQJJHjs82Ug');\n\nconst getCupom = () => {\n  const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n  return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4);\n};\n\nexport default (async (req, res) => {\n  try {\n    await doc.useServiceAccountAuth(credentials);\n    await doc.loadInfo();\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells('A3:B3');\n    const mostrarPromocaoCell = sheetConfig.getCell(2, 0);\n    const textoCell = sheetConfig.getCell(2, 1);\n    let Cupom = '';\n    let Promo = '';\n\n    if (mostrarPromocaoCell.value === 'VERDADEIRO') {\n      Cupom = genCupom();\n      Promo = textoCell.value;\n    }\n\n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      WhatsApp: data.WhatsApp,\n      'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Nota: 5,\n      Cupom,\n      Promo\n    });\n  } catch (error) {\n    res.end(JSON.stringify({\n      showCoupon: false,\n      message: 'error'\n    }));\n  }\n});","map":{"version":3,"sources":["/home/viniciusms1/Projetos/devpleno/palpite-box/pages/api/save.js"],"names":["GoogleSpreadsheet","credentials","moment","doc","getCupom","code","parseInt","format","toString","toUpperCase","substr","req","res","useServiceAccountAuth","loadInfo","sheet","sheetsByIndex","data","JSON","parse","body","sheetConfig","loadCells","mostrarPromocaoCell","getCell","textoCell","Cupom","Promo","value","genCupom","addRow","Nome","Email","WhatsApp","Nota","error","end","stringify","showCoupon","message"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,oBAAlC;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIH,iBAAJ,CAAsB,8CAAtB,CAAZ;;AAEA,MAAMI,QAAQ,GAAG,MAAM;AACrB,QAAMC,IAAI,GAAGC,QAAQ,CAACJ,MAAM,GAAGK,MAAT,CAAgB,iBAAhB,CAAD,CAAR,CAA6CC,QAA7C,CAAsD,EAAtD,EAA0DC,WAA1D,EAAb;AACA,SAAOJ,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,IAAmB,GAAnB,GAAyBL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzB,GAA4C,GAA5C,GAAkDL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAc,CAAd,CAAzD;AACD,CAHD;;AAKA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACjC,MAAI;AACF,UAAMT,GAAG,CAACU,qBAAJ,CAA0BZ,WAA1B,CAAN;AACA,UAAME,GAAG,CAACW,QAAJ,EAAN;AAEA,UAAMC,KAAK,GAAGZ,GAAG,CAACa,aAAJ,CAAkB,CAAlB,CAAd;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWR,GAAG,CAACS,IAAf,CAAb;AAEA,UAAMC,WAAW,GAAGlB,GAAG,CAACa,aAAJ,CAAkB,CAAlB,CAApB;AACA,UAAMK,WAAW,CAACC,SAAZ,CAAsB,OAAtB,CAAN;AAEA,UAAMC,mBAAmB,GAAGF,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAsB,CAAtB,CAA5B;AACA,UAAMC,SAAS,GAAGJ,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAsB,CAAtB,CAAlB;AAEA,QAAIE,KAAK,GAAG,EAAZ;AACA,QAAIC,KAAK,GAAG,EAAZ;;AAEA,QAAGJ,mBAAmB,CAACK,KAApB,KAA8B,YAAjC,EAA8C;AAC5CF,MAAAA,KAAK,GAAGG,QAAQ,EAAhB;AACAF,MAAAA,KAAK,GAAGF,SAAS,CAACG,KAAlB;AACD;;AAGD,UAAMb,KAAK,CAACe,MAAN,CAAa;AACjBC,MAAAA,IAAI,EAAEd,IAAI,CAACc,IADM;AAEjBC,MAAAA,KAAK,EAAEf,IAAI,CAACe,KAFK;AAGjBC,MAAAA,QAAQ,EAAEhB,IAAI,CAACgB,QAHE;AAIjB,4BAAsB/B,MAAM,GAAGK,MAAT,CAAgB,qBAAhB,CAJL;AAKjB2B,MAAAA,IAAI,EAAE,CALW;AAMjBR,MAAAA,KANiB;AAOjBC,MAAAA;AAPiB,KAAb,CAAN;AASD,GA/BD,CA+BE,OAAOQ,KAAP,EAAc;AACdvB,IAAAA,GAAG,CAACwB,GAAJ,CAAQlB,IAAI,CAACmB,SAAL,CAAe;AACrBC,MAAAA,UAAU,EAAE,KADS;AAErBC,MAAAA,OAAO,EAAE;AAFY,KAAf,CAAR;AAID;AACF,CAtCD","sourcesContent":["import { GoogleSpreadsheet } from 'google-spreadsheet';\nimport credentials from '../../credentials.json';\nimport moment from 'moment';\n\nconst doc = new GoogleSpreadsheet('1g9vwNQMbh1YADO14sN_-0R7qFvF9wM3EBQJJHjs82Ug');\n\nconst getCupom = () => {\n  const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n  return code.substr(0,4) + '-' + code.substr(4,4) + '-' + code.substr(8,4)\n}\n\nexport default async (req, res) => {\n  try {\n    await doc.useServiceAccountAuth(credentials);\n    await doc.loadInfo();\n\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells('A3:B3');\n\n    const mostrarPromocaoCell = sheetConfig.getCell(2,0);\n    const textoCell = sheetConfig.getCell(2,1);\n\n    let Cupom = '';\n    let Promo = '';\n\n    if(mostrarPromocaoCell.value === 'VERDADEIRO'){\n      Cupom = genCupom();\n      Promo = textoCell.value;\n    }\n\n    \n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      WhatsApp: data.WhatsApp,\n      'Data Preenchimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Nota: 5,\n      Cupom,\n      Promo\n    })\n  } catch (error) {\n    res.end(JSON.stringify({\n      showCoupon: false,\n      message: 'error'\n    }))\n  }\n}"]},"metadata":{},"sourceType":"module"}